# üìò Gu√≠a de Arquitectura Frontend ‚Äî Agenda M√©dica

### *Referencia primaria del proyecto ‚Äî Siempre revisar antes de crear/modificar c√≥digo*

---

# üß≠ 0. Tabla resumen (Mapa global del proyecto)

| Tipo            | Nombre               | Archivo                         | Descripci√≥n corta                                             |
| --------------- | -------------------- | ------------------------------- | ------------------------------------------------------------- |
| P√°gina          | Agenda de Hoy        | `pages/AgendaSecretaria.tsx`    | Lista del d√≠a, buscador global, cambiar estado, cancelar cita |
| P√°gina          | Nueva Cita           | `pages/NuevaCita.tsx`           | Wizard: paciente ‚Üí especialidad ‚Üí doctor ‚Üí fecha ‚Üí horario    |
| P√°gina          | Pacientes            | `pages/Pacientes.tsx`           | Listado de pacientes + buscador                               |
| P√°gina          | Agenda M√©dico        | `pages/AgendaMedico.tsx`        | Citas del d√≠a filtradas por m√©dico                            |
| P√°gina          | Admin Dashboard      | `pages/AdminDashboard.tsx`      | M√©tricas globales (dummy)                                     |
| Componente      | MainLayout           | `components/MainLayout.tsx`     | Layout + navegaci√≥n principal                                 |
| Componente      | PatientSearch        | `components/PatientSearch.tsx`  | Buscar/crear paciente inline                                  |
| Componente      | SlotSelector         | `components/SlotSelector.tsx`   | Selecci√≥n de horario                                          |
| Componente      | AppointmentRow       | `components/AppointmentRow.tsx` | Renderizado compacto de cita                                  |
| Componente      | StatusBadge          | `components/StatusBadge.tsx`    | Etiqueta visual de estado                                     |
| Hook            | useTodayAppointments | `hooks/useTodayAppointments.ts` | Cargar/gestionar citas del d√≠a                                |
| Hook            | usePatientsSearch    | `hooks/usePatientsSearch.ts`    | B√∫squeda con debounce                                         |
| API (servicios) | api.ts               | `lib/api.ts`                    | Ahora es router hacia Supabase real o dummy por flag/env.     |
| Dummy data      | data.ts, api.dummy.ts| `lib/data.ts`, `lib/api.dummy.ts`| Fuente de data temporal/fallback                             |
| Supabase        | supabaseClient.ts    | `lib/supabaseClient.ts`         | Config inicial (conecta a la BD)                              |
| Tipos           | Appointment          | `types/appointment.ts`          | Modelo de cita                                                |
| Tipos           | Patient              | `types/patient.ts`              | Modelo de paciente                                            |
| Tipos           | Doctor               | `types/doctor.ts`               | M√©dico + especialidad                                         |
| Tipos           | DoctorSchedule       | `types/schedule.ts`             | Agenda del m√©dico                                             |

---

# üîß 1. Convenciones del Proyecto (obligatorias)

- **P√°ginas**: Solo l√≥gica UI, usan hooks y servicios, en `src/pages/`.
- **Servicios/capa API**: `src/lib/api.ts` es el √∫nico entrypoint. NO accedas directo a `api.supabase.ts`.
- **Hooks**: Siempre usan funciones expuestas por `api.ts`.
- **Componentes:** UI m√≠nima, sin fetch, sin l√≥gica de negocio.
- **Tipos:** Definidos en `src/types/`, uno por entidad.

---

# üóÇÔ∏è 2. Capa de Servicios (lib/api.ts, api.supabase.ts, api.dummy.ts)

## 2.1 api.ts (router p√∫blico frontend)

- Expone funciones:  
  `getTodayAppointments`, `getTodayAppointmentsByDoctor`,  
  `updateAppointmentStatus`, `createAppointment`,  
  `getAvailableSlots`, `searchPatients`, `getAllPatients`,  
  `createPatient`, `getSpecialties`, `getDoctorsBySpecialty`, `getDoctors`
- Por defecto usa Supabase real (`api.supabase.ts`).
- Permite swap a dummy data (`api.dummy.ts`) por flag/env (`USE_DUMMY_DATA`).
- Los hooks y p√°ginas solo deben importar de aqu√≠.

## 2.2 api.supabase.ts

- Implementaci√≥n real, usa `supabaseClient`.
- Hace queries reales y aplica l√≥gica de negocio¬†(signalado en la gu√≠a backend).

## 2.3 api.dummy.ts

- Implementaci√≥n paralela de las mismas firmas, retorna dummy data para pruebas/local/demo.
- Nunca deber√≠as acceder directo a esto, salvo para tests o si se activa en el router v√≠a flag.

---

# üîå 3. Integraci√≥n actual Supabase

- `.env` contiene claves y URL de Supabase.
- Debes reiniciar Vite si cambias `.env`.
- El frontend ahora consume directamente de la base real por el router de `api.ts`.
- Acceso a datos reales depende tambi√©n de permisos RLS en Supabase (ver gu√≠a backend).

---

# üß™ 4. Hooks

Los hooks de negocio (ej: `useTodayAppointments`, `usePatientsSearch`):

- Usan siempre las funciones p√∫blicas expuestas por `api.ts`.
- No deben importar directo de `api.supabase.ts`.
- Controlan estado (loading, error, data) y reaccionan a cambios del backend.

---

# üß© 5. Dependencias internas y reglas de oro

- Actualiza/crea cualquier funci√≥n nueva siempre primero en `api.supabase.ts` (implementaci√≥n real), luego exp√≥nla en el router (`api.ts`).
- Los componentes y hooks nunca acceden directo a Supabase ni a dummy; siempre al router `api.ts`.
- Si necesitas l√≥gica fuera de lo ya documentado, debes agregarla en el router y documentarla aqu√≠.
- Ap√≥yate en los tipos de `src/types/`.

---

# üöÄ 6. Control de integraci√≥n / testing

- Cuando desarrolles, puedes activar dummy para aislar el frontend de Supabase si lo necesitas.
- Para ambientes reales, confirma que `USE_DUMMY_DATA` est√° en `false` (o vac√≠o).
- Si notas datos vac√≠os, revisa pol√≠ticas RLS, formato de datos y errores de consola.

---

# üìå 7. Notas r√°pidas de migraci√≥n

- El paso a Supabase es transparente para hooks y pantallas existentes si solo usas `api.ts`.
- Si notas datos incongruentes, primero revisa `.env`, el flag de dummy, y pol√≠ticas RLS en tu base.
- Si hay cambios en la estructura de datos, actualiza primero los tipos en `src/types/`.

---

# üìù 8. Changelog (para sincronizaci√≥n interna)

- **2025-11-19**  
  - Migraci√≥n a Supabase terminada: `api.ts` ahora es proxy/router, dummy data vive en `api.dummy.ts`.
  - Hooks y componentes siguen funcionando sin cambios.
  - Gu√≠a alineada con capa de servicios real y dummy.

---

*Si agregas o modificas flujos, documenta siempre aqu√≠ y sincroniza con el Documento Maestro (`Proyecto_contexto_maestro.md`).*
